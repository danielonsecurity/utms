<!-- templates/config.html -->
{% extends "index.html" %}

{% block page_title %}Configuration{% endblock %}

{% block content %}
<div class="config-container">
  {% for key, value in config.items() %}
  {% if not key.endswith('-choices') %}
  <div class="config-item card">
    <div class="card-header">
      <label for="{{ key }}">{{ key }}</label>
    </div>
    <div class="card-body">
      {% if value is sequence and value is not string %}
      <div class="list-container">
        {% for item in value %}
        <div class="list-item">
          {% set choices_key = key + "-choices" %}
          {% if choices_key in config %}
          <select id="{{ key }}_{{ loop.index0 }}" onchange="handleSelectChange('{{ key }}', {{ loop.index0 }})">
            {% for choice in config[choices_key] %}
            <option value="{{ choice }}" {% if choice == item %}selected{% endif %}>
              {{ choice }}
            </option>
            {% endfor %}
            <option value="__new__">Add New...</option>
          </select>
          {% else %}
          <input type="text" 
                 id="{{ key }}_{{ loop.index0 }}" 
                 value="{{ item }}" />
          {% endif %}
          <button class="btn-save" onclick="saveListItem('{{ key }}', {{ loop.index0 }})">Save</button>
        </div>
        {% endfor %}
        <button class="btn-add" onclick="addListItem('{{ key }}')">Add Item</button>
      </div>
      {% else %}
      {% set choices_key = key + "-choices" %}
      {% if choices_key in config %}
      <select id="{{ key }}" onchange="handleSelectChange('{{ key }}')">
        {% for choice in config[choices_key] %}
        <option value="{{ choice }}" {% if choice == value %}selected{% endif %}>
          {{ choice }}
        </option>
        {% endfor %}
        <option value="__new__">Add New...</option>
      </select>
      {% else %}
      <input type="text" id="{{ key }}" value="{{ value }}" />
      {% endif %}
      <button class="btn-save" onclick="saveConfig('{{ key }}')">Save</button>
      {% endif %}
    </div>
  </div>
  {% endif %}
  {% endfor %}
</div>
{% endblock %}
