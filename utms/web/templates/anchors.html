<!-- templates/anchors.html -->
{% extends "index.html" %}

{% block page_title %}Anchors{% endblock %}

{% block content %}
<div class="anchors-container">
  <div class="anchors-controls">
    <div class="search-bar">
      <i class="material-icons">search</i>
      <input type="text" placeholder="Search anchors..." id="anchorSearch">
    </div>
    <div class="active-filters">
      <div class="filter-label">Active filters:</div>
      <div id="activeFilters" class="filter-tags">
        <!-- Active filters will be inserted here by JavaScript -->
      </div>
      {% if active_filters %}
      <button class="btn-clear" onclick="clearFilters()">Clear All</button>
      {% endif %}
    </div>

  <div class="anchors-grid" id="anchorsGrid">

    {% for label, anchor in anchors.items() %}
    <div class="anchor-card card" data-anchor="{{ label }}">
      <div class="card-header">
        <h3>{{ label }}</h3>
	<button class="anchor-edit-btn" onclick="toggleAnchorEdit('{{ label }}')" title="Edit anchor">
	  <i class="material-icons">edit</i>
	</button>
	<span class="edit-controls" style="display: none;">
          <button class="btn-save" onclick="saveAnchorEdit('{{ label }}')">Save</button>
          <button class="btn-cancel" onclick="cancelAnchorEdit('{{ label }}')">
            <i class="material-icons">close</i>
          </button>
	</span>
      </div>
      <div class="card-body">
        <div class="anchor-info">
          <div class="info-row">
            <span class="info-label">Name:</span>
            <div class="info-value-container">
              <div class="evaluated-value {% if anchor.name_original %}has-original{% endif %}">
		<span class="value-display {% if not anchor.name_original %}edit-target{% endif %}" 
                      data-field="name" 
                      data-type="text">{{ anchor.name }}</span>

		{% if anchor.name_original %}
		<button class="show-original-btn" onclick="toggleOriginal(this)" title="Show original expression">
                  <i class="material-icons">code</i>
		</button>
		<div class="original-code">
                  <pre class="code">{{ anchor.name_original }}</pre>
		</div>
		{% endif %}
              </div>
            </div>
          </div>

          <div class="info-row">
            <span class="info-label">Value:</span>
	    <div class="info-value-container">
              <div class="evaluated-value {% if anchor.value_original %}has-original{% endif %}">
		<span class="value-display {% if not anchor.value_original %}edit-target{% endif %}" 
                      data-field="value" 
                      data-type="number">{{ anchor.value }}</span>
		
		{% if anchor.value_original %}
		<button class="show-original-btn" onclick="toggleOriginal(this)" title="Show original expression">
                  <i class="material-icons">code</i>
		</button>
		<div class="original-code">
                  <pre class="code">{{ anchor.value_original }}</pre>
		</div>
		{% endif %}
              </div>

	    </div>
          </div>

          {% if anchor.uncertainty %}
          <div class="info-row">
            <span class="info-label">Uncertainty:</span>
            <div class="uncertainty-info">
              <div>Absolute: {{ anchor.uncertainty.absolute }}</div>
              <div>Relative: {{ anchor.uncertainty.relative }}</div>
              {% if anchor.uncertainty.confidence_95 %}
              <div>95% Confidence: 
                [{{ anchor.uncertainty.confidence_95[0] }}, 
                {{ anchor.uncertainty.confidence_95[1] }}]
              </div>
              {% endif %}
            </div>
          </div>
          {% endif %}
          <div class="info-row">
            <span class="info-label">Formats:</span>
            <div class="formats-list">
              {% for format in anchor.formats %}
              <div class="format-item">
                {% if format.format %}
                <span class="format-type">{{ format.format }}</span>
                {% endif %}
                {% if format.units %}
                <span class="format-units">{{ format.units|join(', ') }}</span>
                {% endif %}
                {% if format.options %}
                <span class="format-options">{{ format.options }}</span>
                {% endif %}
              </div>
              {% endfor %}
            </div>
          </div>
	  {% if anchor.groups %}
	  <div class="info-row">
	    <span class="info-label">Groups:</span>
	    <span class="info-value groups edit-target" data-field="groups">
              {% for group in anchor.groups %}
              <span class="group-tag">
		<span class="group-name">{{ group }}</span>
		<i class="material-icons group-remove" style="display: none;">close</i>
              </span>
              {% endfor %}
              <button class="add-group-btn" style="display: none;">
		<i class="material-icons">add</i>
              </button>
	    </span>
	  </div>
	  {% endif %}

        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  </div>
  {% endblock %}
